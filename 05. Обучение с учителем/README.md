# Прогнозирование вероятности снижения покупательской активности

## Описание проекта

Интернет-магазин «В один клик» продаёт разные товары: для детей, для дома, мелкую бытовую технику, косметику и даже продукты. Отчёт магазина за прошлый период показал, что активность покупателей начала снижаться. Привлекать новых клиентов уже не так эффективно: о магазине и так знает большая часть целевой аудитории. Возможный выход — удерживать активность постоянных клиентов. Сделать это можно с помощью персонализированных предложений.

**Цель исследования**: разработать и внедрить модель машинного обучения с учителем для прогнозирования вероятности снижения покупательской активности постоянных клиентов на следующие три месяца, используя предоставленные данные. На основании результатов прогноза, а также анализа прибыльности клиентов, необходимо выделить сегменты покупателей и разработать для них персонализированные предложения с целью увеличения их активности.

**Подходы к решению задачи**:
1. промаркировать уровень финансовой активности постоянных покупателей. В компании принято выделять два уровня активности: «снизилась», если клиент стал покупать меньше товаров, и «прежний уровень»;
2. собрать данные по клиентам по следующим группам:
   - признаки, которые описывают коммуникацию сотрудников компании с клиентом;
   - признаки, которые описывают продуктовое поведение покупателя. Например, какие товары покупает и как часто;
   - признаки, которые описывают покупательское поведение клиента. Например, сколько тратил в магазине;
   - признаки, которые описывают поведение покупателя на сайте. Например, как много страниц просматривает и сколько времени проводит на сайте;
3. построить модель, которая предскажет вероятность снижения покупательской активности клиента в следующие три месяца;
4. в исследование нужно включить дополнительные данные финансового департамента о прибыльности клиента: какой доход каждый покупатель приносил компании за последние три месяца;
5. используя данные модели и данные о прибыльности клиентов, нужно выделить сегменты покупателей и разработать для них персонализированные предложения.

## Вывод

В ходе реализации проекта было выполнено:
1. Загрузка данных и изучение информации.
2. Предобработка данных.
3. Исследовательский анализ данных:
   - Построены графики (гистограмма, диаграмма размаха) количественных признаков, (столбчатая диаграмма) категориальных признаков для каждого датафрейма;
   - Отобраны клиенты с покупательской активностью не менее 3 месяцев;
   - Обработаны аномальные значения.
4. Корреляционный анализ данных.
   - Построена матрица корреляции признаков и тепловая карта для ее визуализации. В результате получили сведения о связи входных признаков с целевой переменной.
5. Использование пайплайнов:
   - Кодирование признаков осуществлено с помощью LabelEncoder (целевой признак), OneHotEncoder (категориальные признаки), OrdinalEncoder (ранговые признаки). Для обработки количественных признаков использованы различные методы масштабирования в пайплайне (StandardScaler, MinMaxScaler и вариант без масштабирования); 
   - Создан пайплайн, включающий себя обработку признаков соответствующими методами и инициализацию модели. При помощи RandomizedSearchCV был осуществлен поиск лучшей модели с лучшими гиперпараметрами. Выборка была из 4 обученных моделей: DecisionTreeClassifier, KNeighborsClassifier, LogisticRegression и SVC. В качестве метрики использована ROC-AUC, т.к. она информативна в задачах классификации, особенно когда имеет место дисбаланс классов;
    - Получена одна лучшая молель с гиперпараметрами.
6. Анализ важности признаков:
   - Проведена оценка важности признаков для лучшей модели, построен график важности с помощью метода SHAP. Создана функция для формирования таблицы важности признаков по методу Шепли.
7. Сегментация покупателей:
   - Выполнена сегментация покупателей, используя результаты моделирования и данные о прибыльности покупателей; 
   - Используя лучшую модель и пайплайн, сделаны предсказания и посчитаны вероятности отнесения к классам (покупательская активность снизилась или осталась на прежнем уровне). Результаты добавлены в таблицу;
   - Выделены сегменты покупателей для исследования: 
        - покупатели с высокой прибыльностью и высокой вероятностью снижения активности;
        - покупатели с высокой прибыльностью и низкой вероятностью снижения активности;
        - покупатели с низкой прибыльностью и высокой вероятностью снижения активности;
        - покупатели с низкой прибыльностью и низкой вероятностью снижения активности.
   - Для анализа зависимости вероятности снижения покупательской активности от признаков построены диаграммы рассеяния. Определены признаки, влияющие на изменение вероятности снижения активности выбранного сегмента;
   - Внутри групп выделены подгруппы: покупатели с высокой долей покупок по акции и малой долей. 
8. Составлен усредненный портрет пользователя сайта и даны рекомендации заказчику.
