# Определение стоимости автомобилей

## Описание проекта

Сервис по продаже автомобилей с пробегом «Не бит, не крашен» разрабатывает приложение для привлечения новых клиентов. В нём можно быстро узнать рыночную стоимость своего автомобиля. В нашем распоряжении исторические данные: технические характеристики, комплектации и цены автомобилей. 

**Цель исследования**: построить модель для определения стоимости автомобилей. 

Критерии, важные для заказчика:

- качество предсказания;
- скорость предсказания;
- время обучения.

## Вывод

В ходе реализации проекта было выполнено:

ЭТАП 1. Подготовка данных:
1. **Загрузка данных, изучение информации**.
2. **Предобработка данных**. 
3. **Исследовательский анализ данных**. Выполнено:
  - Созданы функции для визуализации признаков:
     - гистограмма, диаграмма размаха для количественных непрерывных признаков;
     - столбчатая диаграмма для категориальных признаков и дискретных количественных.
  - Проведен статистический анализ признаков. Обнаружены и обработаны аномалии в значениях.
   
Данные в датасете представлены об автомобилях стоимостью от 50 до 20000 евро, средняя цена - 4577.11 евро, медиана - 2900 евро. Больше всего автомобилей с типом кузова седан (sedan) - 26% и хэтчбэки (small) - 22.7%, меньше всего купе (coupe) - 4.55% и внедорожники (suv) - 3.44%. Имеем данные по автомобилям с годом регистрации от 1910 по 2016. С 1990 года заметен значительный рост регистрации автомобилей. Увеличение доходов населения в развивающихся странах привело к большей покупательской способности, что позволило многим людям приобретать автомобили. Также, развитие дорожной сети и общественного транспорта сделало использование личного автомобиля более удобным и безопасным. Больше всего представлено автомобилей с механической коробкой передач (80.85%), с автоматической - 19.14%. Средняя мощность автомобилей 118.71 л.с., медиана - 109 л.с. Общее распределение мощности от 11 до 490 л.с. Наибольшее количество автомобилей с пробегом в категории 150000 - почти 67%, меньше всего - категория 10000 - 0.31%. У 91% автомобилей бензиновая топливная система. Меньше 1% у гибридных, элетрических и газовых систем. В датасете представлено 40 марок автомобилей. Больше всего (21.5%) - Volkswagen, Opel - 11.12%, BMV - 10.54%. Остальных марок менее 10% на каждую. Менее 0.1% у отечественного производителя - Lada. Подвергались ремонту почти 28% автомобилей. 

Доля удаленных данных от исходного датасета: 7.57 %.


4. **Корреляционный анализ данных**. Построена матрица корреляции с использованием phik и тепловая карта для ее визуализации. Согласно шкале Чеддока определена степень зависимости целевого признака от входных: 
- заметная:
   - модель автомобиля (0.574);
   - мощность (0.507);
   - год регистрации (0.584);
- умеренная:
   - был ремонт автомобиля (0.412);
   - марка автомобиля (0.364);
   - пробег (0.325);
   - тип коробки передач (0.336);
- слабая:
   - тип топлива (0.133);
   - тип кузова (0.288).
   
**ЭТАП 2. Обучение моделей**.

1. **Подготовка, деление данных**. Преобразованы все строковые типы признаков в категориальный тип. Датасет разделен на выборки:  тренировочную (train), тестовую (test) и валидационную (valid) в соотношении 3:1:1 (60%, 20%, 20%).


2. **Модель LightGBM**. Создание и обучение. С помощью OptunaSearchCV найдены лучшие гиперпараметры для модели градиентного бустинга LightGBM:

LGBMRegressor(colsample_bytree=0.770371347425082, learning_rate=0.03420458236823464, max_depth=15, min_child_samples=30, num_leaves=1008, subsample=0.5038378442923164)

Время обучения модели с лучшими гиперпараметрами составило 86.36 секунд, предсказания - 3.44 секунды. Метрика RMSE на валидационной выборке равна 1595.57.

3. **Модель LinearRegression**. Создание и обучение. Осуществлено масштабирование количественных признаков с помощью StandardScaler, кодирование с помощью OneHotEncoder. 

Время обучения составило 32.25 секунд, предсказания - 0.02 секунд, метрика RMSE на валидационной выборке равна 3554.93. Критерий успеха RMSE < 2500 не достигнут.

**ЭТАП 3. Анализ моделей**. Полученные результаты метрик и времени обучения, предсказания сохранены в общей таблице.  

Среди двух моделей - LightGBM и LinearRegression наиболее быстрая по времени обучения и предсказания - LinearRegression, но точность данной модели не высокая. Лучше по качеству предсказаний оказалась модель LightGBM.

Выбрана **лучшая модель** - LGBMRegressor с гиперпараметрами: colsample_bytree=0.770371347425082, learning_rate=0.03420458236823464, max_depth=15, min_child_samples=30, num_leaves=1008, subsample=0.5038378442923164.

Качество лучшей модели проверено на тестовых данных:
- Время предсказания: 3.13 секунд;
- RMSE: 1592.34.

Создана функция для отображения важности признаков - построение "барплот" и таблицы с важностью признаков.
Наибольший вклад в ценообразование имеет признак - мощность автомобиля (л.с.), вторым по явлется пробег (км), чуть менее важные - год регистрации, модель и тип коробки передач. А вот тип топливной системы на последнем месте.
