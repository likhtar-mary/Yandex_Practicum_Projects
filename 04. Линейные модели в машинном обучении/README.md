# Молочное хозяйство "Вольный луг"

## Описание проекта

Обратился фермер, владелец молочного хозяйства «Вольный луг». Он хочет купить бурёнок, чтобы расширить поголовье стада коров. Для этого он заключил выгодный контракт с ассоциацией пастбищ «ЭкоФерма».

Условия позволяют фермеру очень тщательно отобрать коров. Он определяет качество молока по строгой методике, и при этом ему нужно выполнять свой план развития молочного хозяйства. Фермер хочет, чтобы каждая бурёнка давала не менее 6000 килограммов молока в год, а её надой был вкусным — строго по его критериям, ничуть не хуже. 

**Цель проекта**: разработать модель машинного обучения, которая поможет фермеру управлять рисками и принимать объективное решение о покупке. 

«ЭкоФерма» готова предоставить подробные данные о своих коровах. 

**Нужно создать две прогнозные модели для отбора бурёнок в поголовье**:
- первая будет прогнозировать возможный удой коровы (целевой признак - Удой);
- вторая — рассчитывать вероятность получить вкусное молоко от коровы (целевой признак - Вкус молока).

**С помощью модели нужно отобрать коров по двум критериям**:
- средний удой за год — не менее 6000 килограммов;
- молоко должно быть вкусным.

## Вывод

При выполнении проекта была изучена информация о датафреймах, исходные данные.

**В процессе предобработки данных** для трех датафреймов были проведены:
   - проверка и исправление некорректной записи названий столбцов;
   - проверка наличия явных дубликатов - удалены;
   - неявные дубликаты/ошибки в значениях колонок - исправлены;
   - проверка наличия пропущенных значений;
   - выявление и удаление аномалий;
   - изменение типов данных. 

2. **В процессе исследовательского анализа данных** было выявлено:
   - **Характеристики корма фермера:** средняя питательность (энергетическая кормовая единица) - 14.55, среднее содержание сырого протеина - 1924 гр, сахаро-протеиновое соотношение (отношение сахара к протеину в корме) имеет среднее значение 0.913.
   - **Характеристики молока фермера:** среднее содержание жиров - 3.60%, среднее содержание белков - 3.076%. Вкусного молока дают коровы больше, чем не вкусного.
   - **Характеристики коров фермера:** в стаде 2 породы: Вис Бик Айдиал и Рефлешн Соверинг. По возрасту - старше 2 лет значительно больше, чем молодых (младше 2 лет). В среднем корова фермера дает 6126 кг удоя в год.
   - **Типы пастбищ фермера:** холмистый и равнинный. Количество холмистых незначительно преобладает над количеством равнинных пастбищ.
   - **Породы папы-быка коров фермера:** Айдиал и Соверин, почти одинаковое количество.
   - **Характеристики молока "ЭкоФермы" (на момент продажи):** средняя жирность - 3.58%, средний уровень белка - 3.069%.
   - **Характеристики коров "ЭкоФермы":** 2 породы: Вис Бик Айдиал и Рефлешн Соверинг. По возрасту - старше 2 лет значительно больше, чем молодых (младше 2 лет).
   - **Типы пастбищ фермера:** холмистый и равнинный. Количество равнинных преобладает над количеством холмистых пастбищ.
   - **Породы папы-быка коров "ЭкоФермы":** преобладает порода папы-быка Соверинг над Айдиал.
   
   
3. **В процессе корреляционного анализа признаков** было выявлено:
   - Высокая связь удоя коровы отслеживается с ЭКЕ (0.72), заметная корреляция с СПО (0.66), жирностью молока (0.7), белком молока (0.59) и породой папы-быка (0.52), умеренная с сырым протеином (0.46). Связь удоя слабая с породой коровы (0.16), типом пастбища (0.28) и вкусом молока (0.17). А вот с возрастом коровы связь сильная - 0.99.
   - На диаграммах рассеяния "Удой - ЭКЕ" видна нелинейная (больше дугообразная) зависимость, умеренная линейная связь удоя коровы с содержанием сырого протеина в корме. Величина СПО больше похожа на категориальную переменную, чем на количественную, т.к видны конкретные значения и распределения по ним (нелинейная связь). Присутствует сильная связь удоя и СПО при категориальных признаках - при увеличении данного параметра удой резко увеличивается. Жирность, белки молока и удой имеют заметную корреляцию.
   - С увеличением питательности корма и сырого протеина в корме увеличивается и удой для всех пород коров. Больший удой и самое жирное молоко дают коровы старше 2 лет, у которых папа-бык породы Айдиал, тип пастбищ - холмистые луга.
   - **Мультиколлинеарность не наблюдается**, т.к о ее наличии свидетельствуют значения корреляции от 0.9 до 0.95, а в данном исследовании таких значений нет. 
   

4. **Обучение модели линейной регрессии**:

В качестве целевого признака для модели линейной регрессии выбран 'удой', отобраны признаки, которые имеют причинно-следственную связь и линейную связь с удоем молока: ЭКЕ (питательность корма), СПО (сахаро-протеиновое соотношение в корме), сырой протеин в корме, порода коровы, тип пастбища, порода папы-быка, возраст коровы. 

Было обучено 3 модели линейной регрессии:
- **Модель 1**. Хорошо предсказывает примерно в 78.4% случаев. Гистограмма распределения остатков показывает, что остатки распределены относительно нормально от нуля. Анализ дисперсии выявил, что остатки распределены неравномерно и на больших значениях целевого признака дисперсия возрастает. Модель недостаточно точно предсказывает целевой признак.
- **Модель 2**. Т.к на этапе корреляционного анализа было обнаружено, что:
   1. СПО и удой связаны нелинейно. На их диаграмме рассеяния наблюдения сгруппированы в 2 кластера и есть такое значение СПО, которое можно считать границей между этими кластерами. Чтобы устранить нелинейность, преобразовали СПО в категориальный бинарный признак, используя эту границу;
   2. ЭКЕ и удой связаны нелинейно. Эта нелинейность была исключена путем введения нового признака - ЭКЕ в квадрате.

После изменений в данных модель хорошо стала предсказывать уже примерно в 81.8% случаев - результат улучшился. Гистограмма распределения остатков показывает, что остатки уже больше стремятся к нулю, присутствует небольшое смещение. Дисперсия остатков на больших значениях все еще увеличивается, дисперсия не равномерная. Модель еще недостаточно точно предсказывает целевой признак.
- **Модель 3**. В данные был добавлен новый признак - это имена пап-быков коров фермера. В результате R2 увеличился незначительно до 82.4%. Гистограмма распределения остатков показывает, что остатки уже больше стремятся к нулю, смещения практически нет. Дисперсия стала более равномерной.

**Проведено сравнение моделей**. Для сравнения качества трех моделей линейной регрессии, сопоставлены их R2 и остатки. Проведена оценка качество каждой модели еще по трем метрикам: MAE, MSE, RMSE. Результат - модель 3 имеет лучшие показатели метрик, следовательно, модель имеет лучшее качество предсказаний по сравнению с моделями 1 и 2. 

**Определен доверительный интервал прогноза третьей модели**, для этого рассчитали квантили ошибки модели. Доверительный интервал:
   - нижняя граница 5425.94
   - верхняя граница 6686.08

С помощью лучшей модели (модель 3) **спрогнозирован удой коров "ЭкоФермы", которых фермер хочет купить**. Для этого были добавлены недостающие признаки ЭКЕ (энергетическая кормовая единица), сырой протеин (г) и СПО (сахаро-протеиновое соотношение). Т.к. технологи фермера пересмотрели подход к кормлению и для новых коров они планируют увеличить значения каждого из этих параметров на 5%, то были рассчитаны средние значения каждого из признаков из датафрейма df_main (коровы фермера) и увеличены на 5%. Из предсказаний модели видно, что коровы, которых желает приобрести фермер, способны произвести молока от 6127 до 6618 кг в год при условии, что технологи фермера увеличат СПО, ЭКЕ и сырой протеин в корме на 5%.

**Требование фермера** - чтобы каждая корова давала не менее 6000 кг молока в год. Все преставленные на продажу коровы "ЭкоФермы" соответствуют условию фермера.

5. **Обучение модели логистической регрессии**:

В качестве целевого признака для модели логистической регрессии обозначен 'вкус_молока'. Для обучения использованы данные из df_main (стадо коров фермера). Добавлено имя папы-быка коров фермера из df_dad, т.к. коровы определенного папы-быка могут давать разное по вкусу молоко. Преобразован признак 'вкус_молока' в категориальный бинарный признак. 

**Оценки качества модели**: доля верных ответов 61.1% (метрика аccuracy). Recall больше precision (0.852 против 0.609), что говорит о том, что ложно-положительных прогнозов больше, чем ложно-отрицательных.

Матрица ошибок: 
- 48 ложно-положительных - не вкусное молоко определяет вкусным;
- 75 истинно-положительных - вскусное молоко определяет вкусным - верно;
- 21 истинно-отрицательных - не вкусное молоко определяет не вкусным - верно;
- 13 ложно-отрицательных - вкусное молоко определяет не вкусным.
Ложно-положительные предсказания (ошибки 1 рода) могут вызвать недовольство покупателей, т.к. не вкусное молоко представляется внусным. Ложно-отрицательнные предсказания (ошибки 2 рода) - вкусное молоко принимается за не вкусное - менее критичны, но могут приводить к потере дохода, если это молоко будет снято с продажи.

Один из **критериев фермера** - молоко должно быть вкусным. Следовательно, нужно исключать ошибку 1 рода - данная ошибка критичнее всего в данной задаче. Касательно метрик: precision наиболее важная из всех, т.к. чем выше значение precision, тем меньше ложно-положительных предсказаний модели.

**Выполнен поиск порога принадлежности к классам**, при котором критичная ошибка будет сведена к нулю: пороговое значение, при котором precision = 1 и FP (ложно-положительные предсказания) = 0, равняется 0.82. При этом метрика accuracy = 44,58%, а recall = 0.01.

**Минимизация ошибок 1 рода привела** к увеличению ошибок 2 рода: ложно-отрицательных предсказаний стало 87 вместо 13 изначальных. Таким образом, вкусное молоко определяется не вкусным в 87 случаях. При этом модель смогла предсказать истинно-положительный результат только в 1 случае. Таким образом, избегая ложно-положительных результатов мы пришли к большому количеству ложно-отрицательных.

**Спрогнозирован вкус молока коров "ЭкоФермы"**, которые фермер хочет купить. Для этого: добавлены недостающие признаки ЭКЕ (энергетическая кормовая единица), сырой протеин (г) и СПО (сахаро-протеиновое соотношение). Т.к. технологи фермера пересмотрели подход к кормлению и для новых коров они планируют увеличить значения каждого из этих параметров на 5%, то: были рассчитаны средние значения каждого из признаков и увеличены на 5%.

**Получены предсказания** при установке порогового значения 0.82, при котором ложно-положительные предсказания равняются нулю. Результат: у всех коров "ЭкоФермы" не вкусное молоко.

**Требования фермера**:
   1.  чтобы каждая корова давала не менее 6000 кг молока в год. Все преставленные на продажу коровы "ЭкоФермы" соответствуют условию фермера.
   2. молоко должно быть вкусным. При установке порогового значения 0.82, при котором ложно-положительные предсказания равняются нулю, у всех коров "ЭкоФермы" не вкусное молоко.
